# Malzette (Section 6)

## Part 1: Generation (Section 6.1)

Run `generate_malzette.py` with python/pypy. With pypy3 should be reproducible to get the same values (tested on PyPy 7.3.13).

The data is written into [data.tex](./data.tex), including tex tables and python arrays with constants.

```sh
pypy3 generate_malzette.py

probs -2.193 -1.830
bals [39]
samples 18 unique
01111111111111111111111111111000 01111111111111111111111111111100 11111111111111111111111111111100
01111111111111111111111111111100 11111111111111111111111111111000 01111111111111111111111111111100
10000000000000000000000000000011 00000000000000000000000000000111 10000000000000000000000000000011

probs -3.193 -2.830
bals [1, 2, 4, 5, 7, 8, 10, 11, 13, 14]
samples 600 unique
01111111111111110000000000000011 11111111111111111000000000000011 01111111111111111000000000000111
01111111111111100000000000000011 01111111111111000000000000000011 11111111111111100000000000000111
01111111111000000000000000000011 01111111111100000000000000000111 11111111111100000000000000000011

probs -4.193 -3.830
bals [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]
samples 1303 unique
01111111111111111111100000000100 11111011111111111111100000000100 01111011111111111111000000000000
11111101111111111000000000000100 01111111111111111000000000000100 01111101111111110000000000000000
11111101111111111110000000000000 01111101111111111100000000000100 01111111111111111110000000000100

Malzette1
=========
seed 2
Round 0 prob -2.192645075255167
diffs 01111111111111111111111111111000 01111111111111111111111111111100 11111111111111111111111111111100
const 00000000 4e381c1c 00000000000000000000000000000000 01001110001110000001110000011100

Round 1 prob -2.192645075255167
diffs 11111111111111111111111111111100 01111111111111111111111111111100 01111111111111111111111111111000
const 2aaaaaaa 36dbe492 00101010101010101010101010101010 00110110110110111110010010010010

Round 2 prob -1.8300750012449165
diffs 00000000000000000000000000000011 10000000000000000000000000000011 10000000000000000000000000000111
const 7fffffff 1236db6c 01111111111111111111111111111111 00010010001101101101101101101100

Round 3 prob -1.8300750012449165
diffs 00000000000000000000000000000011 10000000000000000000000000000011 10000000000000000000000000000111
const 55555555 0763638e 01010101010101010101010101010101 00000111011000110110001110001110

Round 4 prob -2.192645075255167
diffs 01111111111111111111111111111000 01111111111111111111111111111100 11111111111111111111111111111100
const 2aaaaaaa 1b6d4949 00101010101010101010101010101010 00011011011011010100100101001001

Round 5 prob -1.8300750012449165
diffs 10000000000000000000000000000111 10000000000000000000000000000011 00000000000000000000000000000011
const 55555555 638ef1c7 01010101010101010101010101010101 01100011100011101111000111000111

Round 6 prob -2.192645075255167
diffs 11111111111111111111111111111100 01111111111111111111111111111100 01111111111111111111111111111000
const 00000000 47638e39 00000000000000000000000000000000 01000111011000111000111000111001

Round 7 prob -2.192645075255167
diffs 01111111111111111111111111111000 01111111111111111111111111111100 11111111111111111111111111111100
const 2aaaaaaa 5236b6db 00101010101010101010101010101010 01010010001101101011011011011011

Round 8 prob -1.8300750012449165
diffs 10000000000000000000000000000111 10000000000000000000000000000011 00000000000000000000000000000011
const 55555555 4e381c1c 01010101010101010101010101010101 01001110001110000001110000011100

Round 9 prob -2.192645075255167
diffs 11111111111111111111111111111100 01111111111111111111111111111100 01111111111111111111111111111000
const 7fffffff 638eb1c7 01111111111111111111111111111111 01100011100011101011000111000111

Round 10 prob -2.192645075255167
diffs 11111111111111111111111111111100 01111111111111111111111111111100 01111111111111111111111111111000
const 7fffffff 47638e39 01111111111111111111111111111111 01000111011000111000111000111001

Round 11 prob -2.192645075255167
diffs 11111111111111111111111111111100 01111111111111111111111111111100 01111111111111111111111111111000
const 3f2bb31e b6c004cc

RX-differential: k = 3
7ffffff8 3ffffffe
 --12R-->
b989d417 0347a2a9
total prob -24.861460607021


probs -2.193 -1.830
bals [39]
samples 18 unique
01111111111111111111111111111000 01111111111111111111111111111100 11111111111111111111111111111100
01111111111111111111111111111100 11111111111111111111111111111000 01111111111111111111111111111100
10000000000000000000000000000011 00000000000000000000000000000111 10000000000000000000000000000011

probs -3.193 -2.830
bals [1, 2, 4, 5, 7, 8, 10, 11, 13, 14]
samples 600 unique
01111111111111110000000000000011 11111111111111111000000000000011 01111111111111111000000000000111
01111111111111100000000000000011 01111111111111000000000000000011 11111111111111100000000000000111
01111111111000000000000000000011 01111111111100000000000000000111 11111111111100000000000000000011

probs -4.193 -3.830
bals [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]
samples 1303 unique
01111111111111111111100000000100 11111011111111111111100000000100 01111011111111111111000000000000
11111101111111111000000000000100 01111111111111111000000000000100 01111101111111110000000000000000
11111101111111111110000000000000 01111101111111111100000000000100 01111111111111111110000000000100

Malzette2
=========
seed 2
Round 0 prob -2.830074998557688
diffs 01111111111111110000000000000011 11111111111111111000000000000011 01111111111111111000000000000111
const 1c71c924 249cad47 00011100011100011100100100100100 00100100100111001010110101000111

Round 1 prob -1.8300750012449165
diffs 10000000000000000000000000000011 00000000000000000000000000000011 10000000000000000000000000000111
const 49249c71 1249871c 01001001001001001001110001110001 00010010010010011000011100011100

Round 2 prob -3.192645077942396
diffs 10000000000000000111111111111100 10000000000000000111111111111100 00000000000000001111111111111000
const 6db6c71c 5b127ffe 01101101101101101100011100011100 01011011000100100111111111111110

Round 3 prob -1.8300750012449165
diffs 00000000000000000000000000000111 10000000000000000000000000000011 10000000000000000000000000000011
const 38e39249 152ad249 00111000111000111001001001001001 00010101001010101101001001001001

Round 4 prob -2.830074998557688
diffs 01111111111111110000000000000011 01111111111111111000000000000011 11111111111111111000000000000111
const 638e36db 649cad55 01100011100011100011011011011011 01100100100111001010110101010101

Round 5 prob -1.8300750012449165
diffs 10000000000000000000000000000111 00000000000000000000000000000011 10000000000000000000000000000011
const 1c71c7ff 471c9492 00011100011100011100011111111111 01000111000111001001010010010010

Round 6 prob -2.830074998557688
diffs 01111111111111111111100000000100 01111111111111111111000000000000 11111111111111111111100000000100
const 36db6d55 63f1c71d 00110110110110110110110101010101 01100011111100011100011100011101

Round 7 prob -2.192645075255167
diffs 01111111111111111111111111111000 01111111111111111111111111111100 11111111111111111111111111111100
const 471c7249 36a4ff1c 01000111000111000111001001001001 00110110101001001111111100011100

Round 8 prob -3.192645077942396
diffs 10000000000000000001111111111111 00000000000000000000111111111011 10000000000000000000111111111011
const 4924938e 5b6c8e47 01001001001001001001001110001110 01011011011011001000111001000111

Round 9 prob -1.8300750012449165
diffs 10000000000000000000000000000111 10000000000000000000000000000011 00000000000000000000000000000011
const 2aab6db6 71c736db 00101010101010110110110110110110 01110001110001110011011011011011

Round 10 prob -2.830074998557688
diffs 01111111111100000000000000000100 11111111111110000000000000000000 01111111111110000000000000000100
const 6db638e3 55b9c71d 01101101101101100011100011100011 01010101101110011100011100011101

Round 11 prob -2.192645075255167
diffs 01111111111111111111111111111100 01111111111111111111111111111000 11111111111111111111111111111100
const fb3d2330 b6da4b61

RX-differential: k = 3
7fff0003 ffffc001
 --12R-->
dd2bc54b 078b106c
total prob -29.411180305605544
```

The file `data.tex`:

```
Table constants


1 & \texttt{00000000}:\texttt{4e381c1c} & -2.19 & \texttt{1c71c924}:\texttt{249cad47} & -2.83 \\
2 & \texttt{2aaaaaaa}:\texttt{36dbe492} & -2.19 & \texttt{49249c71}:\texttt{1249871c} & -1.83 \\
3 & \texttt{7fffffff}:\texttt{1236db6c} & -1.83 & \texttt{6db6c71c}:\texttt{5b127ffe} & -3.19 \\
4 & \texttt{55555555}:\texttt{0763638e} & -1.83 & \texttt{38e39249}:\texttt{152ad249} & -1.83 \\
5 & \texttt{2aaaaaaa}:\texttt{1b6d4949} & -2.19 & \texttt{638e36db}:\texttt{649cad55} & -2.83 \\
6 & \texttt{55555555}:\texttt{638ef1c7} & -1.83 & \texttt{1c71c7ff}:\texttt{471c9492} & -1.83 \\
7 & \texttt{00000000}:\texttt{47638e39} & -2.19 & \texttt{36db6d55}:\texttt{63f1c71d} & -2.83 \\
8 & \texttt{2aaaaaaa}:\texttt{5236b6db} & -2.19 & \texttt{471c7249}:\texttt{36a4ff1c} & -2.19 \\
9 & \texttt{55555555}:\texttt{4e381c1c} & -1.83 & \texttt{4924938e}:\texttt{5b6c8e47} & -3.19 \\
10 & \texttt{7fffffff}:\texttt{638eb1c7} & -2.19 & \texttt{2aab6db6}:\texttt{71c736db} & -1.83 \\
11 & \texttt{7fffffff}:\texttt{47638e39} & -2.19 & \texttt{6db638e3}:\texttt{55b9c71d} & -2.83 \\
12 & \texttt{3f2bb31e}:\texttt{b6c004cc} & -2.19 & \texttt{fb3d2330}:\texttt{b6da4b61} & -2.19 \\
\bottomrule
Total & & -24.86 & & -29.41 \\



Table trails


1 & \fontsize{8}{8}\texttt{7ffffff8}:\texttt{7ffffffc}:\texttt{fffffffc} & -2.19 & \fontsize{8}{8}\texttt{7fff0003}:\texttt{ffff8003}:\texttt{7fff8007} & -2.83 \\
2 & \fontsize{8}{8}\texttt{fffffffc}:\texttt{7ffffffc}:\texttt{7ffffff8} & -2.19 & \fontsize{8}{8}\texttt{80000003}:\texttt{00000003}:\texttt{80000007} & -1.83 \\
3 & \fontsize{8}{8}\texttt{00000003}:\texttt{80000003}:\texttt{80000007} & -1.83 & \fontsize{8}{8}\texttt{80007ffc}:\texttt{80007ffc}:\texttt{0000fff8} & -3.19 \\
4 & \fontsize{8}{8}\texttt{00000003}:\texttt{80000003}:\texttt{80000007} & -1.83 & \fontsize{8}{8}\texttt{00000007}:\texttt{80000003}:\texttt{80000003} & -1.83 \\
5 & \fontsize{8}{8}\texttt{7ffffff8}:\texttt{7ffffffc}:\texttt{fffffffc} & -2.19 & \fontsize{8}{8}\texttt{7fff0003}:\texttt{7fff8003}:\texttt{ffff8007} & -2.83 \\
6 & \fontsize{8}{8}\texttt{80000007}:\texttt{80000003}:\texttt{00000003} & -1.83 & \fontsize{8}{8}\texttt{80000007}:\texttt{00000003}:\texttt{80000003} & -1.83 \\
7 & \fontsize{8}{8}\texttt{fffffffc}:\texttt{7ffffffc}:\texttt{7ffffff8} & -2.19 & \fontsize{8}{8}\texttt{7ffff804}:\texttt{7ffff000}:\texttt{fffff804} & -2.83 \\
8 & \fontsize{8}{8}\texttt{7ffffff8}:\texttt{7ffffffc}:\texttt{fffffffc} & -2.19 & \fontsize{8}{8}\texttt{7ffffff8}:\texttt{7ffffffc}:\texttt{fffffffc} & -2.19 \\
9 & \fontsize{8}{8}\texttt{80000007}:\texttt{80000003}:\texttt{00000003} & -1.83 & \fontsize{8}{8}\texttt{80001fff}:\texttt{00000ffb}:\texttt{80000ffb} & -3.19 \\
10 & \fontsize{8}{8}\texttt{fffffffc}:\texttt{7ffffffc}:\texttt{7ffffff8} & -2.19 & \fontsize{8}{8}\texttt{80000007}:\texttt{80000003}:\texttt{00000003} & -1.83 \\
11 & \fontsize{8}{8}\texttt{fffffffc}:\texttt{7ffffffc}:\texttt{7ffffff8} & -2.19 & \fontsize{8}{8}\texttt{7ff00004}:\texttt{fff80000}:\texttt{7ff80004} & -2.83 \\
12 & \fontsize{8}{8}\texttt{fffffffc}:\texttt{7ffffffc}:\texttt{7ffffff8} & -2.19 & \fontsize{8}{8}\texttt{7ffffffc}:\texttt{7ffffff8}:\texttt{fffffffc} & -2.19 \\
\bottomrule
Total & & -24.86 & & -29.41 \\



consts_Malzette1 = [
    (0x00000000, 0x4e381c1c),
    (0x2aaaaaaa, 0x36dbe492),
    (0x7fffffff, 0x1236db6c),
    (0x55555555, 0x0763638e),
    (0x2aaaaaaa, 0x1b6d4949),
    (0x55555555, 0x638ef1c7),
    (0x00000000, 0x47638e39),
    (0x2aaaaaaa, 0x5236b6db),
    (0x55555555, 0x4e381c1c),
    (0x7fffffff, 0x638eb1c7),
    (0x7fffffff, 0x47638e39),
    (0x3f2bb31e, 0xb6c004cc),
]

consts_Malzette2 = [
    (0x1c71c924, 0x249cad47),
    (0x49249c71, 0x1249871c),
    (0x6db6c71c, 0x5b127ffe),
    (0x38e39249, 0x152ad249),
    (0x638e36db, 0x649cad55),
    (0x1c71c7ff, 0x471c9492),
    (0x36db6d55, 0x63f1c71d),
    (0x471c7249, 0x36a4ff1c),
    (0x4924938e, 0x5b6c8e47),
    (0x2aab6db6, 0x71c736db),
    (0x6db638e3, 0x55b9c71d),
    (0xfb3d2330, 0xb6da4b61),
]

differential_Malzette1 = [
    (0x7ffffff8, 0x3ffffffe),
    (0xb989d417, 0x0347a2a9),
]
differential_Malzette2 = [
    (0x7fff0003, 0xffffc001),
    (0xdd2bc54b, 0x078b106c),
]

const uint32_t differential_trail_Malzette1[] = {
    0xfffffffc,
    0x7ffffff8,
    0x80000007,
    0x80000007,
    0xfffffffc,
    0x00000003,
    0x7ffffff8,
    0xfffffffc,
    0x00000003,
    0x7ffffff8,
    0x7ffffff8,
    0x7ffffff8,
};
const uint32_t differential_trail_Malzette2[] = {
    0x7fff8007,
    0x80000007,
    0x0000fff8,
    0x80000003,
    0xffff8007,
    0x80000003,
    0xfffff804,
    0xfffffffc,
    0x80000ffb,
    0x00000003,
    0x7ff80004,
    0xfffffffc,
};

7ffffff8:3ffffffe
b989d417:0347a2a9
7fff0003:ffffc001
dd2bc54b:078b106c
```


## Part 2: Verification (Section 6.2)

This part verifies experimentally the trails/distinguishers.

```sh
# 2^36 data and random seeds
$ make verifyMalzette && ./verifyMalzette 36 32bc5a5a1ecb7b3d 701351185d7297c3
make: 'verifyMalzette' is up to date.
...
Malzette1: 2121/68719476736 = 2^-24.95 experimental differential probability
Malzette1: 2121/2121/68719476736 = 2^-24.95 experimental trail probability
...
Malzette2: 60/68719476736 = 2^-30.09 experimental differential probability
Malzette2: 60/60/68719476736 = 2^-30.09 experimental trail probability
```

Full logs are available in [verify_36.log.txt](./verify_36.log.txt) and [verify_40.log.txt](./verify_40.log.txt).